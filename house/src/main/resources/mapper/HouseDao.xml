<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dzj.house.dao.HouseDao">

	<select id="queryAllHouseByUserId" resultType="com.dzj.house.entity.House">
		select * from house where user_id=#{userId}
	</select>

	<insert id="insertHouse"
		parameterType="com.dzj.house.entity.House" useGeneratedKeys="true"
		keyColumn="house_id" keyProperty="houseId">
		INSERT INTO house (
		title,
		price,
		area,
		room,
		floor,
		total_floor,
		watch_times,
		build_year,
		status,
		create_time,
		last_update_time,
		city_en_name,
		region_en_name,
		cover,
		direction,
		distance_to_subway,
		parlour,
		district,
		user_id,
		bathroom,
		street,
		city_cn_name
		)
		VALUES
		(
		#{title},
		#{price},
		#{area},
		#{room},
		#{floor},
		#{totalFloor},
		#{watchTimes},
		#{buildYear},
		#{status},
		#{createTime},
		#{lastUpdateTime},
		#{cityEnName},
		#{redionEnName},
		#{cover},
		#{direction},
		#{distanceToSubway},
		#{parlour},
		#{district},
		#{userId},
		#{bathroom},
		#{street},
		#{cityCnName}	


		)

	</insert>
	
	
	<update id="updateFrontPicture">
		
		update house set front_picture =#{path} where house_id=#{houseId} and user_id=#{userId}
		
	</update>
	
	<select id="getSearchCount" resultType="java.lang.Integer">
		select count(1) from
		 	house left join house_detail
			on house.house_id = house_detail.house_id
			<where>
				<if test="searchDto.cityEnName !=null">
					and city_en_name=#{searchDto.cityEnName}
				</if>
				
				<if test="searchDto.subwayId != -1">
					and subway_id=#{searchDto.subwayId}
				</if>
				<if test="searchDto.subwayName != null">
					and subway_name=#{searchDto.subwayName}
				</if>
				<if test="searchDto.room != -1">
					and room=#{searchDto.room}
				</if>
				
				<if test="searchDto.direction !=null">
					and direction = #{searchDto.direction}
				</if>
				
				<if test="searchDto.regionEnName != null">
					and region_en_name =#{searchDto.regionEnName}
				</if>
				
				<if test="searchDto.priceMin != -1 and searchDto.priceMax != -1">
					and price between #{searchDto.priceMin} and #{searchDto.priceMax}
				</if>
				<if test="searchDto.priceMin != -1 and searchDto.priceMax == -1">
					and price between #{searchDto.priceMin} and 100000000
				</if>
				
				<if test="searchDto.priceMin == -1 and searchDto.priceMax != -1">
					and price between 0 and #{searchDto.priceMax}
				</if>
				
				<if test="searchDto.areaMin != -1 and searchDto.areaMax != -1">
					and price between #{searchDto.areaMin} and #{searchDto.areaMax}
				</if>
				<if test="searchDto.areaMin != -1 and searchDto.areaMax == -1">
					and price between #{searchDto.areaMin} and  100000
				</if>
				
				<if test="searchDto.areaMin == -1 and searchDto.areaMax != -1">
					and price between 0 and #{searchDto.areaMax}
				</if>
				
			</where>
			
	</select>
	
	<select id="getFrontHouseList" resultType="com.dzj.house.dto.FrontHouseListDto">
		select 
			house.house_id,
			title,
			price,
			room,
			area,
			floor,
			city_cn_name,
			total_floor,
			front_picture,
			district,
			last_update_time,
			build_year,
			parlour,
			direction,
			distance_to_subway,
			subway_name,
			subway_station_name
			from 
			house left join house_detail
			on house.house_id = house_detail.house_id
			<where>
				<if test="searchDto.cityEnName !=null">
					and city_en_name=#{searchDto.cityEnName}
				</if>
				
				<if test="searchDto.subwayId != -1">
					and subway_id=#{searchDto.subwayId}
				</if>
				<if test="searchDto.subwayName != null">
					and subway_name=#{searchDto.subwayName}
				</if>
				<if test="searchDto.room != -1">
					and room=#{searchDto.room}
				</if>
				
				<if test="searchDto.direction !=null">
					and direction = #{searchDto.direction}
				</if>
				
				<if test="searchDto.regionEnName != null">
					and region_en_name =#{searchDto.regionEnName}
				</if>
				
				<if test="searchDto.priceMin != -1 and searchDto.priceMax != -1">
					and price between #{searchDto.priceMin} and #{searchDto.priceMax}
				</if>
				<if test="searchDto.priceMin != -1 and searchDto.priceMax == -1">
					and price between #{searchDto.priceMin} and 100000000
				</if>
				
				<if test="searchDto.priceMin == -1 and searchDto.priceMax != -1">
					and price between 0 and #{searchDto.priceMax}
				</if>
				
				<if test="searchDto.areaMin != -1 and searchDto.areaMax != -1">
					and price between #{searchDto.areaMin} and #{searchDto.areaMax}
				</if>
				<if test="searchDto.areaMin != -1 and searchDto.areaMax == -1">
					and price between #{searchDto.areaMin} and  100000
				</if>
				
				<if test="searchDto.areaMin == -1 and searchDto.areaMax != -1">
					and price between 0 and #{searchDto.areaMax}
				</if>
				
			</where>
			
			order by ${searchDto.orderBy} ${searchDto.orderDirection}
			limit #{rowIndex},#{pageSize}
			
	</select>
	
	
	
</mapper>
